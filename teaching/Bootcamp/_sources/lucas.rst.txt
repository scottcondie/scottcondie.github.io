.. default-role:: math

*****************************************
The Lucas Tree Model of Asset Pricing
*****************************************


The probability space
========================

We start with a state-space representation of the uncertainty in this model.


Suppose that there is a finite set `Z` of possible states that can occur each period.  The state space is `\Omega = Z^{\infty}`, the set of infinite sequences of elements of `Z`.  So a particular state `\omega \in \Omega` is a path `\omega = (z_1,z_2,z_3,\ldots,z_t,\ldots)`.

Note
  This is not the most general formulation of this problem, but will give all of the results that we need for our goals.  Specifically, the state-space representation we give can be generalized to an arbitrary probability space with a filtration that satisfies certain properties.


We will assume that many random variables are measurable with respect to the natural filtration generated by the space `\Omega` at a particular time `t`.

Definition
  A random variable `x` is *measurable* with respect to the partition generated by `\Omega` at time `t` if whenever  `\omega_{\tau}  = \omega'_{\tau}` for all `\tau \le t`, `x(\omega) = x(\omega')`.  That is, `x` is measurable with respect to the partition generated by `\Omega` at time `t` if whenever two paths are identical up to time `t`, the random variable `x` is the same across those two paths.

This property defines what can be known at any given time.  If we require a random variable to be measurable with respect to the time `t` partition, we are saying that it can't depend on things that happen after time `t`.

Example
  Let `W = [1,2,3]`.  Consider two paths `\omega = (1,2,3,\ldots)` and `\omega' = (1,2,1,\ldots)`.  Define the random variables `x = \omega_1 + \omega_{2}` and `x' = \omega_1 + \omega_2 + \omega_{3}`.  These random variables take on the following values

  .. math::

    x(\omega) & = 3\\
    x(\omega') & = 3

  and

  .. math::

    x'(\omega) & = 6 \\
    x'(\omega') & = 4

  The random variable `x` is measurable with respect to the partition generated by `\Omega` at times `1`, 2 and 3.  The random variable `x'` is not measurable with respect to the partition generated by `\Omega` at times 1 and 2, but is measurable with respect to the partition generated at time 3. `x'` is not measurable with respect to the time 2 partition because `\omega` and `\omega'` are the same up to time `2` and yet `x'` assigned different values to these two paths.  Note that `x`  is measurable with respect to the time 3 partition because the previous definition does not require that a random variable take on different values across paths that differ.

Definition
  The sequence of partitions generated by `\Omega` is called a *filtration*.

Definition
  A sequence of random variables `(x^1,x^2,\ldots)` where each `x^{\tau}` is measurable with respect to the partition generated by `\Omega` at time `\tau` is said to be *adapted to the filtration generated by* `\Omega`.

A sequence of random variables adapted to the filtration generated by `\Omega` has the property that its values at time `t` depend only on things that have happened up to time `t`.  This is a property that we will require of most of the random sequences that we study.  So much so, that we use the notation `x = (x_1,x_2,x_3,\ldots)` to denote random variables that are adapted to the filtration generated by our space `\Omega`.

A probability distribution `\mu` is a function from the measurable sets into the real line.  For the kinds of models studied here, one can think of probabilities as mapping from *cylinders* of paths, which are sets of the form `\{\omega: (\omega_{1}, \omega_{2}, \omega_{3}, \ldots, \omega_{t}) = (z_{1}, z_{2}, \ldots, z_{t}) \}`.  These probabilities will correspond to the probability of reaching a node on the event tree (in the definition above, the node whose first `t` realizations are `(z_{1}, z_{2}, \ldots, z_{t})`.  Expectation of a random variable `x`, given the partition `\Omega_{t}` is then taken in the usual way, 

.. math::

  Ex = \sum_{w \in \Omega_{t}} x(w)\mu(w)

If `x` is adapted to the partition `\Omega_{t}`, then `x(\omega) = x(\omega')` for any `\omega, \omega' \in w \in \Omega_{t}`, so `x(w)` in the above expression is defined to be the value of `x` along any path in the cylinder defined by `w`.  

The Investor's Problem
=========================

Consider an investor who has preferences over her lifetime consumption that take the form

.. math::
  :label: objective-function

  E\left [ \sum_{t=0}^{\infty}\beta^{t}u(c_{t}(\omega)) \right ].

This expectation is taken over the set of paths `\Omega` and (as noted above) the random sequence `c = (c_0,c_1,\ldots)` is assumed to be adapted to the filtration generated by `\Omega`.
The sequences `\{c_{t}\}_{t=0}^{\infty}` are stochastic and depend on the realization of uncertainty and the investment choices of the individual in a way that will become clear.

Note
  We will assume that `u(\cdot)` is strictly concave so that `E\left [ \sum_{t=0}^{\infty}\beta^{t}u(c_{t}(\omega)) \right ]` is also strictly concave.  This allows us to dispense with second order conditions.

The individual has access to assets labeled `1,\ldots,N`.  Each asset `n` pays a dividend `d_{nt}` at time `t` that is also assumed to be stochastic and is paid in units of consumption at time `t`.  The investor starts at time 0 with shares of the assets given by `\overline{\boldsymbol{\theta}_{0}} = \left ( \overline{\theta_{1}},\overline{\theta_{2}},\ldots, \overline{\theta_{n}} \right )'`.  Asset holdings at the end of time `t` and the beginning of time `t+1` are `\boldsymbol{\theta}_{t}`.

The prices of the assets at time `t` are given by `\boldsymbol{p}_{t} = (p_{1t},p_{2t},\ldots,p_{nt})'` (all vectors in these notes are assumed to be column vectors unless otherwise stated).  We assume that these prices are expressed in terms of units of the  consumption good available at time `t`.

The budget constraint of the investor at time 0 is

.. math::

  c_{0} + \boldsymbol{p}'_{1}\overline{\boldsymbol{\theta}_{0}} = \boldsymbol{d'_{0}}\overline{\boldsymbol{\theta}} +  \boldsymbol{p'_{0}}\overline{\boldsymbol{\theta}}.

The budget constraint at time `t` is given by

.. math::

  c_{t} + \boldsymbol{p}'_{t}\boldsymbol{\theta}_{t} = (\boldsymbol{d'_{t}} + \boldsymbol{p'_{t}}) \boldsymbol{\theta}_{t-1}.

Rewriting this we obtain the equation

.. math::
  :label: budget-constraint

  c_{t} = \boldsymbol{d}'_t \boldsymbol{\theta}_{t-1} +  \boldsymbol{p}'_{t}\left ( \boldsymbol{\theta}_{t-1} - \boldsymbol{\theta}_{t} \right ).

Notice that all of the random variables (and random vectors) in the problem above depend implicitly on the realization `\omega` and are assumed to be adapted to the filtration generated by `\Omega`.

After plugging the budget constraint in equation :eq:`budget-constraint` into the problem in equation :eq:`objective-function` we are left with the problem

.. math::

  \max_{\boldsymbol{\theta}_{0},\boldsymbol{\theta}_{1}, \ldots} E\left [ \sum_{t=0}^{\infty}\beta^{t}u\left ( \boldsymbol{d}'_t \boldsymbol{\theta}_{t-1} +  \boldsymbol{p}'_{t}\left ( \boldsymbol{\theta}_{t-1} - \boldsymbol{\theta}_{t} \right )   \right ) \right ].

Consider the first order conditions for this problem with respect to `\boldsymbol{\theta}_{t}`.  These are

.. math::

  E\left [-\beta^t u'(c_t)\boldsymbol{p}_t  + \beta^{t+1}u'(c_{t+1})\left (\boldsymbol{d}_{t+1} + \boldsymbol{p}_{t+1} \right )    \right ] = 0

which can be simplified to

.. math::

  -u'(c_t)\left(\boldsymbol{p}_t \right )  + \beta^{t+1} E\left [ u'(c_{t+1})(\boldsymbol{d}_{t+1} + \boldsymbol{p}_{t+1}) | \Omega_{t}    \right ] = 0.

Consider the row corresponding to asset `i` of these vector Euler conditions.  It is

.. math::

  u'(c_t)\left(d_{i,t} - p_{i,t} \right )  + \beta E\left [ u'(c_{t+1})p_{i,t+1} | \Omega_{t}    \right ] = 0.

Solving this equation for the price of asset `i` at time `t` we obtain the relationship

.. math::
  :label: one-period-euler

  p_{i,t} = \beta E \left [ \frac{u'(c_t+1)}{u'(c_{t})}(d_{i,t+1} + p_{i,t+1})  |\Omega_{t}   \right].

This fundamental relationship allows us to answer lots of questions about how the value of assets is determined.  We will look at this relationship in several different ways.

The stochastic discount factor (SDF)
=======================================

Let the adapted random variable `m_{t+1}` be defined as

.. math::

  m_{t+1} = \beta \frac{u'(c_{t+1})}{u'(c_{t})}.

This sequence of random variables `m = (m_{1},m_{2},\ldots)` is called the *stochastic discount factor* or SDF.  Notice that with this definition, equation :eq:`one-period-euler` can be written as

.. math::
  :label: one-period-sdf

  p_{i,t} = E[m_{t+1}(p_{i,t+1} + d_{i,t+1})|\Omega_{t}].

The SDF has intuitive meaning.  To understand it, lets first divide both sides of the previous equation by `p_{i,t}` to get

.. math::

  1 = E \left [m_{t+1}\left (\frac{p_{i,t+1} + d_{i,t+1}}{p_{i,t}}\right )|\Omega_{t} \right].

Define the expression

.. math::

  R_{i,t+1} = \frac{p_{i,t+1} + d_{i,t+1}}{p_{i,t}}

covariance of `X` and `Y` is `cov(X,Y) = E(XY) - E(X)(Y)`.  Thus, we can rewrite equation :eq:`one-period-sdf` as

.. math::
  :label: moment-condition

  1 = cov(m_{t+1},R_{i,t+1}) + E[m_{t+1}|\Omega_{t}]E[R_{i,t+1}|\Omega_{t}]

Since the SDF is the ratio of marginal utilities, it is large in states next period when marginal utility is high compared to today.  Under standard assumptions of decreasing marginal utility, that means that the SDF is big in states where consumption is small. Likewise, in states where consumption is large, the SDF is small.  Therefore, the term `cov(m_{t+1},R_{i,t+1})` will be large if *on average* the return to asset `i` is large when marginal utility next period is large.  That is, `cov(m_{t+1},R_{i,t+1})` will be large if on average the return to asset `i` is high when consumption next period is low.  This result leads to the common practice in the literature of calling `-cov(m_{t+1},R_{i,t+1})` the *risk* of asset `i`.


Now consider the previous equation for asset `j`.   Combining it with the equation for asset `i` gives the relationship

.. math::
  :label: i-j-comparison

  cov(m_{t+1},R_{i,t+1}) + E[m_{t+1}|\Omega_{t}]E[R_{i,t+1}|\Omega_{t}] =   cov(m_{t+1},R_{j,t+1}) + E[m_{t+1}|\Omega_{t}]E[R_{j,t+1}|\Omega_{t}]

This demonstrates a fundamental relationship between the expected return to an asset and that asset's covariance with the investor's marginal utility.  Since the term `E[u'(c_{t+1})|\Omega_{t}]` is common across assets `i` and `j`, if asset `i` has a higher expected return than asset `j` then the investor will select a portfolio such that the covariance of asset `i` with marginal utility (the SDF) is low.  That is, assets with high risk must also have high returns.  In other words, the individual will choose a portfolio where the expected return of each asset exactly compensates the trader for the risk born in holding the asset.

The risk-free rate of return
==============================

Using the SDF, we can calculate several things that are of interest.  Consider first the price of an asset that pays one unit of consumption next period in every state of the world.  Following that, the asset ceases to exist.  The price of that asset today will allow us to calculate the risk-free rate of return in this economy from period `t` to period `t+1`.  From equation :eq:`one-period-sdf`, the price today of such an asset would be

.. math::

  p_{i,t} = E[m_{t+1}|\Omega_{t}].

Thus, one unit of consumption tomorrow costs `E[m_{t+1}|\Omega_{t}]` today.  Therefore, the (gross) risk-free rate of return today is

.. math::
  :label: risk-free-rate

  1 + r_{f} = \frac{1}{E[m_{t+1}|\Omega_{t}]}.

This relationship demonstrates the reason behind the name SDF.  The present value of one unit consumption tomorrow is

.. math::

  E[m_{t+1}|\Omega_{t}],

while in general the present value of any random payoff `x` tomorrow is

.. math::

  p_{t} = E[m_{t+1}x|\Omega_{t}].

Armed with this definition, we can now reinterpret equation :eq:`i-j-comparison`.  Rewriting, this equation becomes

.. math::

  cov(m_{t+1},R_{i,t+1}) + \frac{E[R_{i,t+1}|\Omega_{t}]}{1+r_{f}} =   cov(m_{t+1},R_{j,t+1}) + \frac{E[R_{j,t+1}|\Omega_{t}]}{1+r_{f}}.

Expressions of the form  `\frac{E[R_{i,t+1}|\Omega_{t}]}{1+r_{f}}` can now be interpreted as the *risk-premium* associated with asset `i`.  That is, the expected return above the return that one would obtain for investing in a risk-free asset.  This equation then says that assets with high risk (assets for which `-cov(m_{t+1},R_{i,t+1})` is small) will have high expected returns when the trader is holding an optimal portfolio.

Exercises
=============

These exercises will give some familiarity with the GMM estimation of asset pricing models.  
Assume that the joint distribution of `(m_{t+1}, R_{t+1})` is constant for all `t` (this would occur, for example, if the stochastic process `\omega` is Markov.)
Define `m_{t+1} = \beta \frac{u'(c_{t+1})}{u'(c_{t})}` with `u(c) = \frac{c^{1-\gamma}}{1-\gamma}`.  Download data on real personal consumption expenditures (FRED series PCECC96) and returns to the aggregate U.S. stock market (e.g. the Wilshire 5000 given in FRED series WILL5000INDFC) as well as the risk-free rate (FRED series GDPDEF, the GDP deflator, is one possible measure of inflation).  One possibility for data on the risk-free rate is the 3-month T-Bill rate given in FRED series TB3MS.  Note that you will need to transform the Wilshire 5000 series and the T-Bill series into quarterly data as well as calculate the real returns to the Wilshire 5000 by accounting for inflation.

Answer the following questions:
    1. Assume that `\beta = 0.99` (since this is quarterly data, this implies an annual risk-free rate of about 4%).  Calculate empirical analogs of the expected values and covariance in :eq:`moment-condition`.  Using :code:`scipy.optimize.broyden1`, solve for the value of `\gamma` that leads to equation :eq:`moment-condition` holding.  
    2. How would you determine if this parameter is reasonable?
    3. Now, consider the moment restriction given in equation :eq:`risk-free-rate`.  Continue to assume that `\beta = 0.99`.  Estimate the `\gamma` that generates the SDF using only this moment condition.  How does this `\gamma` differ from the estimate of `\gamma` found previously?
    4.   Finally, estimate `beta` and `gamma` using both equation :eq:`moment-condition` and equation :eq:`risk-free-rate`.  You will need to specify a weighting matrix (the identity matrix is a great place to start).  Plot the objective function for different `(\beta, \gamma)` pairs.  How does your estimation differ from the previous two ways of estimating those parameters?
    


Note.
  The idea behind these problems comes from `Hansen and Singleton (1982) <https://www.jstor.org/stable/1911873?seq=1#page_scan_tab_contents>`_, although the implementation has some differences.  For a survey of this literature, see `Campbell (2003) <https://www.sciencedirect.com/science/article/pii/S1574010203010227>`_.
